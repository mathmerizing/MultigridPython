\documentclass{article}
\thispagestyle{empty}

%Laden externer Dateien
\usepackage{import}
%Laden der Package-Konfigurationen
\import{../../../Documents/Latex/Preamble/}{pre_packages.tex}
%Lade die Klasse script
%\loadclass{script}

\usepackage{listings}

%Definiere Counter /numctr zur Nummerierung von equations
\newcounter{numctr}
%FÃ¼ge /section in die Reset-Liste von /numctr hinzu
\makeatletter
\@addtoreset{numctr}{section}
\makeatother

%Math-Umgebungen werden umbrechbar
\allowdisplaybreaks

\pgfplotsset{compat=1.16}

\def\I{\mathbb}


% plotting
\usepackage{pgf,tikz,pgfplots}
\usepackage{mathrsfs}
\usetikzlibrary{arrows}

\usepackage{tikz-cd} 
\usepackage{xcolor}
\usepackage{svg}

\usepackage{hyperref}
\hypersetup{linktoc=all, linkcolor=blue}

% define div operator
\DeclareMathOperator{\diverg}{div}
% define curl operator
\DeclareMathOperator{\curl}{curl}
% define restriction of function
\newcommand\restrict[1]{\raisebox{-.5ex}{$|$}_{#1}}


\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.96}
\definecolor{lightgray}{rgb}{1,1,1}
 
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{lightgray},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{blue},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,         
    breaklines=true,                 
    captionpos=b,                    
    keepspaces=true,                 
    numbers=left,                    
    numbersep=5pt,                  
    showspaces=false,                
    showstringspaces=false,
    showtabs=false,                  
    tabsize=2,
    xleftmargin=3pt
}
 
\lstset{style=mystyle}
\lstset{escapeinside={<@}{@>}}
\begin{document}

\pagestyle{plain}
\lstset{language=Python}
\begin{lstlisting}[mathescape=true]
for <@\textcolor{black!40!green}{triangle}@> $K$ in grid.triangles:
	for <@\textcolor{black!40!green}{DoF}@> $\phi_i$ in $K$.dofs:
		$b_h$[$\phi_i$.globalIndex] += $f \left|\det\left(\nabla T_K^{-1}(x)\right)\right| \int_{K} \phi_i\ dx$
		for <@\textcolor{black!40!green}{DoF}@> $\phi_j$ in $K$.dofs:
			$A_h$[$\phi_i$.globalIndex, $\phi_j$.globalIndex] += $\int_{K}$
\end{lstlisting}
\end{document}